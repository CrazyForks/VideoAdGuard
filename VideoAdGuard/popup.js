(()=>{"use strict";document.addEventListener("DOMContentLoaded",(async()=>{const e=document.getElementById("apiUrl"),t=document.getElementById("apiKey"),n=document.getElementById("model"),r=document.getElementById("save"),a=document.getElementById("message"),o=document.getElementById("result");if(!(e&&t&&n&&r&&a&&o))return;const s=await chrome.storage.local.get(["apiUrl","apiKey","model"]);s.apiUrl&&(e.value=s.apiUrl),s.apiKey&&(t.value=s.apiKey),s.model&&(n.value=s.model),r.addEventListener("click",(async()=>{const r=e.value.trim(),o=t.value.trim(),s=n.value.trim();if(!r)return a.textContent="请输入API地址",void(a.className="error");if(!o)return a.textContent="请输入API密钥",void(a.className="error");if(!s)return a.textContent="请输入模型名称",void(a.className="error");try{await chrome.storage.local.set({apiUrl:r,apiKey:o,model:s}),a.textContent="设置已保存",a.className="success"}catch(e){a.textContent="保存设置失败",a.className="error",console.error("保存设置失败:",e)}})),chrome.tabs.query({active:!0,currentWindow:!0},(e=>{const t=e[0];t&&t.id&&chrome.tabs.sendMessage(t.id,{type:"GET_AD_INFO"},(e=>{chrome.runtime.lastError?o.textContent="当前不在哔哩哔哩视频页面":e&&e.adInfo?o.textContent=`${e.adInfo}`:o.textContent="未检测到广告信息"}))}))}))})();