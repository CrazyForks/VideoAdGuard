(()=>{"use strict";document.addEventListener("DOMContentLoaded",(async()=>{const e=document.getElementById("apiUrl"),t=document.getElementById("apiKey"),a=document.getElementById("model"),l=document.getElementById("save"),o=document.getElementById("message"),n=document.getElementById("result"),d=document.getElementById("localOllama"),c=document.getElementById("autoSkipAd"),s=document.getElementById("toggleApiKey");if(document.getElementsByClassName("apiKey-field")[0],s&&t&&s.addEventListener("click",(()=>{const e="password"===t.getAttribute("type")?"text":"password";t.setAttribute("type",e);const a=s.querySelector(".eye-open"),l=s.querySelector(".eye-closed");"text"===e?(a.style.display="none",l.style.display="block"):(a.style.display="block",l.style.display="none")})),d.addEventListener("change",(function(e){e.target.checked?document.body.classList.add("ollama-enabled"):document.body.classList.remove("ollama-enabled")})),!(e&&t&&a&&l&&o&&n&&c))return;const r=await chrome.storage.local.get(["apiUrl","apiKey","model","enableLocalOllama","autoSkipAd"]);r.apiUrl&&(e.value=r.apiUrl),r.apiKey&&(t.value=r.apiKey),r.model&&(a.value=r.model),r.enableLocalOllama&&(d.checked=r.enableLocalOllama,document.body.classList.add("ollama-enabled")),r.autoSkipAd&&(c.checked=r.autoSkipAd),l.addEventListener("click",(async()=>{const l=e.value.trim(),n=t.value.trim(),s=a.value.trim(),r=d.checked,i=c.checked;if(!l)return o.textContent="请输入API地址",void(o.className="error");if(!r&&!n)return o.textContent="请输入API密钥",void(o.className="error");if(!s)return o.textContent="请输入模型名称",void(o.className="error");try{await chrome.storage.local.set({apiUrl:l,apiKey:n,model:s,enableLocalOllama:r,autoSkipAd:i}),o.textContent="设置已保存",o.className="success"}catch(e){o.textContent="保存设置失败",o.className="error",console.error("保存设置失败:",e)}})),chrome.tabs.query({active:!0,currentWindow:!0},(e=>{const t=e[0];t&&t.id&&(t.url?.includes("bilibili.com/video/")||t.url?.includes("bilibili.com/list/watchlater")?chrome.tabs.sendMessage(t.id,{type:"GET_AD_INFO"},(e=>{chrome.runtime.lastError?n.textContent="插件未完全加载，请等待或刷新":e&&e.adInfo?n.textContent=`${e.adInfo}`:n.textContent="未检测到广告信息"})):n.textContent="当前不在哔哩哔哩视频页面")}))}))})();