(()=>{"use strict";document.addEventListener("DOMContentLoaded",(async()=>{const e=document.getElementById("apiUrl"),t=document.getElementById("apiKey"),a=document.getElementById("model"),n=document.getElementById("save"),l=document.getElementById("message"),o=document.getElementById("result"),c=document.getElementById("localOllama");if(c.addEventListener("change",(function(e){const t=e.target;document.getElementsByClassName("apiKey-field")[0].style.display=t.checked?"none":"block"})),!(e&&t&&a&&n&&l&&o))return;const r=await chrome.storage.local.get(["apiUrl","apiKey","model","enableLocalOllama"]);r.apiUrl&&(e.value=r.apiUrl),r.apiKey&&(t.value=r.apiKey),r.model&&(a.value=r.model),r.enableLocalOllama&&(c.checked=r.enableLocalOllama,document.getElementsByClassName("apiKey-field")[0].style.display="none"),n.addEventListener("click",(async()=>{const n=e.value.trim(),o=t.value.trim(),r=a.value.trim(),s=c.checked;if(!n)return l.textContent="请输入API地址",void(l.className="error");if(!s&&!o)return l.textContent="请输入API密钥",void(l.className="error");if(!r)return l.textContent="请输入模型名称",void(l.className="error");try{await chrome.storage.local.set({apiUrl:n,apiKey:o,model:r,enableLocalOllama:s}),l.textContent="设置已保存",l.className="success"}catch(e){l.textContent="保存设置失败",l.className="error",console.error("保存设置失败:",e)}})),chrome.tabs.query({active:!0,currentWindow:!0},(e=>{const t=e[0];t&&t.id&&chrome.tabs.sendMessage(t.id,{type:"GET_AD_INFO"},(e=>{chrome.runtime.lastError?o.textContent="当前不在哔哩哔哩视频页面":e&&e.adInfo?o.textContent=`${e.adInfo}`:o.textContent="未检测到广告信息"}))}))}))})();