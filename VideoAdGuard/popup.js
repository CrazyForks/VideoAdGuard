(()=>{"use strict";document.addEventListener("DOMContentLoaded",(async()=>{const e=document.getElementById("apiUrl"),t=document.getElementById("apiKey"),l=document.getElementById("model"),a=document.getElementById("save"),n=document.getElementById("message"),o=document.getElementById("result"),c=document.getElementById("localOllama"),d=document.getElementById("autoSkipAd"),s=document.getElementById("toggleApiKey");if(s&&t&&s.addEventListener("click",(()=>{const e="password"===t.getAttribute("type")?"text":"password";t.setAttribute("type",e);const l=s.querySelector(".eye-open"),a=s.querySelector(".eye-closed");"text"===e?(l.style.display="none",a.style.display="block"):(l.style.display="block",a.style.display="none")})),c.addEventListener("change",(function(e){const t=e.target;document.getElementsByClassName("apiKey-field")[0].style.display=t.checked?"none":"block"})),!(e&&t&&l&&a&&n&&o&&d))return;const i=await chrome.storage.local.get(["apiUrl","apiKey","model","enableLocalOllama","autoSkipAd"]);i.apiUrl&&(e.value=i.apiUrl),i.apiKey&&(t.value=i.apiKey),i.model&&(l.value=i.model),i.enableLocalOllama&&(c.checked=i.enableLocalOllama,document.getElementsByClassName("apiKey-field")[0].style.display="none"),i.autoSkipAd&&(d.checked=i.autoSkipAd),a.addEventListener("click",(async()=>{const a=e.value.trim(),o=t.value.trim(),s=l.value.trim(),i=c.checked,r=d.checked;if(!a)return n.textContent="请输入API地址",void(n.className="error");if(!i&&!o)return n.textContent="请输入API密钥",void(n.className="error");if(!s)return n.textContent="请输入模型名称",void(n.className="error");try{await chrome.storage.local.set({apiUrl:a,apiKey:o,model:s,enableLocalOllama:i,autoSkipAd:r}),n.textContent="设置已保存",n.className="success"}catch(e){n.textContent="保存设置失败",n.className="error",console.error("保存设置失败:",e)}})),chrome.tabs.query({active:!0,currentWindow:!0},(e=>{const t=e[0];t&&t.id&&(t.url?.includes("bilibili.com/video/")||t.url?.includes("bilibili.com/list/watchlater")?chrome.tabs.sendMessage(t.id,{type:"GET_AD_INFO"},(e=>{chrome.runtime.lastError?o.textContent="插件未完全加载，请等待或刷新":e&&e.adInfo?o.textContent=`${e.adInfo}`:o.textContent="未检测到广告信息"})):o.textContent="当前不在哔哩哔哩视频页面")}))}))})();